<!--
  ~  Copyright (c) 2013 The Finnish Board of Education - Opetushallitus
  ~
  ~  This program is free software: Licensed under the EUPL, Version 1.1 or - as
  ~  soon as they will be approved by the European Commission - subsequent versions
  ~  of the EUPL (the "Licence");
  ~
  ~  You may not use this work except in compliance with the Licence.
  ~  You may obtain a copy of the Licence at: http://ec.europa.eu/idabc/eupl
  ~
  ~  This program is distributed in the hope that it will be useful,
  ~  but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  ~  European Union Public Licence for more details.
  -->


<div class="oppiaine-view" ng-show="!editMode">

  <div class="action-buttons-inline">
    <div class="action-button" ng-if="isReconnectable()">
      <span kaanna="ei-yhdistetty-pohjaan" style="color: red; padding-right: 20px;"></span>
      <button class="btn btn-default" kaanna="'palauta-yhteys'"
              ng-click="connectOppiaine()"></button>
    </div>
    <div class="action-button" ng-if="connected()">
      <span kaanna="yhdistetty-pohjaan" style="color: limegreen; padding-right: 20px;"></span>
      <button class="btn btn-default" kaanna="'katkaise-yhteys'"
              ng-click="disconnectOppiaine()"></button>
    </div>
    <div class="action-button" ng-if="isDeletable()">
      <button class="btn btn-default" icon-role="remove" kaanna="'poista'"
              ng-click="deleteOppiaine()"></button>
    </div>
    <div class="action-button" ng-if="canAddOppimaara()">
      <button class="btn btn-default" icon-role="add" kaanna="'lisaa-oppimaara'"
              ng-click="addOppimaara()"></button>
    </div>
  </div>
  <h3 ng-bind="oppiaine.nimi | kaanna"></h3>

  <hr class="mujuviiva"/>
  <!--<pre>{{oppiaine | json}}</pre>-->
  <!--<pre>{{oppiaine.kurssit | json}}</pre>-->

  <div class="action-buttons-inline">
    <button class="btn btn-default" kaanna="'tuo-perusteesta'"></button>
    <button class="btn btn-default" kaanna="'lisaa-kurssi'"></button>
  </div>
  <h4 kaanna="oppiaine-kurssit"></h4>
  <br/>

  <div ng-repeat="kurssi in oppiaine.kurssit">
    <div class="oppiaine-sisaltopuu lukio-oppiaineet-puu">
      <a ng-click="openKurssi(kurssi)" class="container-link tree-list-item ng-scope bubble-osa empty-item">
        <span class="span-container puu-node kurssi-node">
          <span class="colorbox kurssi-tyyppi {{kurssi.perusteen.tyyppi | lowercase}}"></span>
          <span class="aikaleima ng-binding">{{kurssi.muokattu | aikaleima: 'short' }}</span>
          <span class="kurssikoodi">{{kurssi.koodiUri}} {{kurssi.nimi | kaanna}}</span>
        </span>
      </a>
    </div>
  </div>

  <div class="lukio-oppiaineet-puu lukio-oppiaine-tab lukio-oppiaine-tyypit" ng-if="oppiaine && !kuvauksetIsEmpty(valtakunnallisetKurssiTyypit) || !kuvauksetIsEmpty(paikallisetKurssiTyypit)">
    <div class="main-column tree" style="margin-bottom: 20px;">
      <div class="tree-con">
        <div class="opetussisaltopuu tree">
          <div class="legendContainer">
            <div class="legends" style="width: 100%;">
              <a ng-click="kurssiKuvauksetVisible=!kurssiKuvauksetVisible" class="left legend">
                {{ kurssiKuvauksetVisible?'piilota-kurssityyppi-kuvaukset':'nayta-kurssityyppi-kuvaukset' | kaanna}}
                <span ng-class="{'glyphicon-chevron-right': !kurssiKuvauksetVisible, 'glyphicon-chevron-down': kurssiKuvauksetVisible}"
                      class="glyphicon"></span></a>

              <div class="left legend" style="float: right;">
                <div class="left legend"
                     ng-repeat="tyyppi in ['valtakunnallinen', 'paikallinen','pakollinen', 'syventava', 'soveltava']">
                  <span class="colorbox kurssi-tyyppi {{tyyppi}}"></span>
                  <span class="legend-name" ng-bind="'kurssi-tyyppi-selite-'+tyyppi | kaanna"></span>
                </div>
              </div>
            </div>
            <br/>

            <div ng-if="kurssiKuvauksetVisible">
              <br/>

              <div ng-if="!kuvauksetIsEmpty(valtakunnallisetKurssiTyypit)">
                <h2 kaanna="valtakunnalliset-kurssityypit"></h2>
                <lukio-oppiaine-osa ng-repeat="t in valtakunnallisetKurssiTyypit" editable="isEditable()"
                                    oppiaine="oppiaine" perusteen-teksti="oppiaine.perusteen.kurssiTyyppiKuvaukset[t.key]"
                                    colorbox="t.tyyppi" oppiaineen-teksti="oppiaine.kurssiTyyppiKuvaukset[t.key]"
                                    title="t.tyyppi+'-kurssi'"></lukio-oppiaine-osa>
              </div>
              <br/><br/>

              <div ng-if="!kuvauksetIsEmpty(paikallisetKurssiTyypit)">
                <h2 kaanna="paikalliset-kurssityypit"></h2>

                <lukio-oppiaine-osa ng-repeat="t in paikallisetKurssiTyypit" editable="isEditable()"
                                    oppiaine="oppiaine" perusteen-teksti="oppiaine.perusteen.kurssiTyyppiKuvaukset[t.key]"
                                    colorbox="t.tyyppi" ikoni="true" oppiaineen-teksti="oppiaine.kurssiTyyppiKuvaukset[t.key]"
                                    title="t.tyyppi+'-kurssi'"></lukio-oppiaine-osa>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <lukio-oppiaine-osa oppiaine="oppiaine" perusteen-teksti="oppiaine.perusteen.tehtava.teksti" editable="isEditable()"
                      oppiaineen-teksti="oppiaine.tehtava.teksti" title="'oppiaine-osa-tehtava'"></lukio-oppiaine-osa>

  <lukio-oppiaine-osa oppiaine="oppiaine" perusteen-teksti="oppiaine.perusteen.tavoitteet.teksti" editable="isEditable()"
                      oppiaineen-teksti="oppiaine.tavoitteet.teksti" title="'oppiaine-osa-tavoitteet'"></lukio-oppiaine-osa>

  <lukio-oppiaine-osa oppiaine="oppiaine" perusteen-teksti="oppiaine.perusteen.arviointi.teksti" editable="isEditable()"
                      oppiaineen-teksti="oppiaine.arviointi.teksti" title="'oppiaine-osa-arviointi'"></lukio-oppiaine-osa>
</div>

<div class="lisaa-oppiaine oppiaine-form" ng-show="editMode">
  <h2 kaanna="'lisaa-oppimaara-title'" ng-show="isMaara()"></h2>
  <h2 kaanna="'lisaa-oppiaine-title'" ng-show="!isMaara()"></h2>

  <div class="non-collapsibles">
    <form name="oppiaineForm" role="form">
      <div class="action-buttons">
        <div class="floater" ng-include="'views/opetussuunnitelmat/lukio/include/oppiaineOsavalitsin.html'">
        </div>
      </div>

      <div ng-include="'views/opetussuunnitelmat/lukio/include/oppiaineLomakeKentat.html'"></div>
    </form>
  </div>
</div>
